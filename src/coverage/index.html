<!DOCTYPE html>
<html xmlns='http://www.w3.org/1999/xhtml'>
  <head>
    <title>Code coverage for Src</title>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <script src='./assets/0.13.2/application.js' type='text/javascript'></script>
    <link href='./assets/0.13.2/application.css' media='screen, projection, print' rel='stylesheet' type='text/css' />
    <link rel="icon" type="image/png" href="./assets/0.13.2/favicon_red.png" />
  </head>

  <body data-branch-coverage=true>
    <div id="loading">
      <img src="./assets/0.13.2/loading.gif" alt="loading"/>
    </div>
    <div id="wrapper" class="hide">
      <div class="timestamp">Generated <abbr class="timeago" title="2025-11-15T22:50:16-04:00">2025-11-15T22:50:16-04:00</abbr></div>
      <ul class="group_tabs"></ul>

      <div id="content">
        <div class="file_list_container" id="AllFiles">
  <h2>
    <span class="group_name">All Files</span>
    (<span class="covered_percent">
      <span class="red">
  42.0%
</span>

     </span>
     covered at
     <span class="covered_strength">
       <span class="red">
         0.55
       </span>
    </span> hits/line
    )
  </h2>

  <a name="AllFiles"></a>

  <div>
    <b>20</b> files in total.
  </div>

  <div class="t-line-summary">
    <b>250</b> relevant lines,
    <span class="green"><b>105</b> lines covered</span> and
    <span class="red"><b>145</b> lines missed. </span>
    (<span class="red">
  42.0%
</span>
)
  </div>

  
    <div class="t-branch-summary">
      <span><b>60</b> total branches, </span>
      <span class="green"><b>10</b> branches covered</span> and
      <span class="red"><b>50</b> branches missed.</span>
      (<span class="red">
  16.67%
</span>
)
    </div>
  

  <div class="file_list--responsive">
    <table class="file_list">
      <thead>
        <tr>
          <th>File</th>
          <th class="cell--number">% covered</th>
          <th class="cell--number">Lines</th>
          <th class="cell--number">Relevant Lines</th>
          <th class="cell--number">Lines covered</th>
          <th class="cell--number">Lines missed</th>
          <th class="cell--number">Avg. Hits / Line</th>
          
            <th class="cell--number">Branch Coverage</th>
            <th class="cell--number">Branches</th>
            <th class="cell--number">Covered branches</th>
            <th class="cell--number">Missed branches </th>
          
        </tr>
      </thead>
      <tbody>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#4b0b944644245afdb80fdd4aac7ee09453c55796" class="src_link" title="app/channels/application_cable/channel.rb">app/channels/application_cable/channel.rb</a></td>
            <td class="red strong cell--number t-file__coverage">0.00 %</td>
            <td class="cell--number">6</td>
            <td class="cell--number">4</td>
            <td class="cell--number">0</td>
            <td class="cell--number">4</td>
            <td class="cell--number">0.00</td>
            
              <td class="green strong cell--number t-file__branch-coverage">100.00 %</td>
              <td class="cell--number">0</td>
              <td class="cell--number">0</td>
              <td class="cell--number">0</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#8181a49ff6d7331e707f049341e8d92db1c6f454" class="src_link" title="app/channels/application_cable/connection.rb">app/channels/application_cable/connection.rb</a></td>
            <td class="red strong cell--number t-file__coverage">0.00 %</td>
            <td class="cell--number">6</td>
            <td class="cell--number">4</td>
            <td class="cell--number">0</td>
            <td class="cell--number">4</td>
            <td class="cell--number">0.00</td>
            
              <td class="green strong cell--number t-file__branch-coverage">100.00 %</td>
              <td class="cell--number">0</td>
              <td class="cell--number">0</td>
              <td class="cell--number">0</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#6f25a249069c8a178c03cf938e71ea7952c3d9d7" class="src_link" title="app/controllers/application_controller.rb">app/controllers/application_controller.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">4</td>
            <td class="cell--number">1</td>
            <td class="cell--number">1</td>
            <td class="cell--number">0</td>
            <td class="cell--number">1.00</td>
            
              <td class="green strong cell--number t-file__branch-coverage">100.00 %</td>
              <td class="cell--number">0</td>
              <td class="cell--number">0</td>
              <td class="cell--number">0</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#28dc070c00ce99a1a465dd32179fa5d0655a660c" class="src_link" title="app/controllers/customers_controller.rb">app/controllers/customers_controller.rb</a></td>
            <td class="red strong cell--number t-file__coverage">0.00 %</td>
            <td class="cell--number">11</td>
            <td class="cell--number">8</td>
            <td class="cell--number">0</td>
            <td class="cell--number">8</td>
            <td class="cell--number">0.00</td>
            
              <td class="green strong cell--number t-file__branch-coverage">100.00 %</td>
              <td class="cell--number">0</td>
              <td class="cell--number">0</td>
              <td class="cell--number">0</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#554e6341cdf32c44da0971e5b05c9ff9409c6de1" class="src_link" title="app/controllers/email_logs_controller.rb">app/controllers/email_logs_controller.rb</a></td>
            <td class="red strong cell--number t-file__coverage">0.00 %</td>
            <td class="cell--number">38</td>
            <td class="cell--number">31</td>
            <td class="cell--number">0</td>
            <td class="cell--number">31</td>
            <td class="cell--number">0.00</td>
            
              <td class="green strong cell--number t-file__branch-coverage">100.00 %</td>
              <td class="cell--number">0</td>
              <td class="cell--number">0</td>
              <td class="cell--number">0</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#263ae34344ee20cd4c0ebc43c6f89344572d21c3" class="src_link" title="app/controllers/logs_controller.rb">app/controllers/logs_controller.rb</a></td>
            <td class="red strong cell--number t-file__coverage">0.00 %</td>
            <td class="cell--number">11</td>
            <td class="cell--number">8</td>
            <td class="cell--number">0</td>
            <td class="cell--number">8</td>
            <td class="cell--number">0.00</td>
            
              <td class="green strong cell--number t-file__branch-coverage">100.00 %</td>
              <td class="cell--number">0</td>
              <td class="cell--number">0</td>
              <td class="cell--number">0</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#cd1e38f3cbd5978b5a56932d7629b21265ce8a56" class="src_link" title="app/controllers/uploads_controller.rb">app/controllers/uploads_controller.rb</a></td>
            <td class="red strong cell--number t-file__coverage">64.00 %</td>
            <td class="cell--number">114</td>
            <td class="cell--number">50</td>
            <td class="cell--number">32</td>
            <td class="cell--number">18</td>
            <td class="cell--number">1.10</td>
            
              <td class="red strong cell--number t-file__branch-coverage">28.57 %</td>
              <td class="cell--number">14</td>
              <td class="cell--number">4</td>
              <td class="cell--number">10</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#0537408f1b7bd07757ef3ef19a7d949a1b6f9767" class="src_link" title="app/helpers/application_helper.rb">app/helpers/application_helper.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">4</td>
            <td class="cell--number">1</td>
            <td class="cell--number">1</td>
            <td class="cell--number">0</td>
            <td class="cell--number">1.00</td>
            
              <td class="green strong cell--number t-file__branch-coverage">100.00 %</td>
              <td class="cell--number">0</td>
              <td class="cell--number">0</td>
              <td class="cell--number">0</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#cbc3afba71da952ac69800a388d5e0f6b1654554" class="src_link" title="app/jobs/application_job.rb">app/jobs/application_job.rb</a></td>
            <td class="red strong cell--number t-file__coverage">75.00 %</td>
            <td class="cell--number">18</td>
            <td class="cell--number">4</td>
            <td class="cell--number">3</td>
            <td class="cell--number">1</td>
            <td class="cell--number">0.75</td>
            
              <td class="green strong cell--number t-file__branch-coverage">100.00 %</td>
              <td class="cell--number">0</td>
              <td class="cell--number">0</td>
              <td class="cell--number">0</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#d01bea3a02c1dbab7b460e99b0e9b144898919a7" class="src_link" title="app/jobs/process_email_job.rb">app/jobs/process_email_job.rb</a></td>
            <td class="red strong cell--number t-file__coverage">0.00 %</td>
            <td class="cell--number">24</td>
            <td class="cell--number">17</td>
            <td class="cell--number">0</td>
            <td class="cell--number">17</td>
            <td class="cell--number">0.00</td>
            
              <td class="green strong cell--number t-file__branch-coverage">100.00 %</td>
              <td class="cell--number">0</td>
              <td class="cell--number">0</td>
              <td class="cell--number">0</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#95356d33c21b0e24cd315f2c802349ba8ed590d0" class="src_link" title="app/jobs/process_upload_job.rb">app/jobs/process_upload_job.rb</a></td>
            <td class="red strong cell--number t-file__coverage">11.54 %</td>
            <td class="cell--number">53</td>
            <td class="cell--number">26</td>
            <td class="cell--number">3</td>
            <td class="cell--number">23</td>
            <td class="cell--number">0.12</td>
            
              <td class="red strong cell--number t-file__branch-coverage">0.00 %</td>
              <td class="cell--number">16</td>
              <td class="cell--number">0</td>
              <td class="cell--number">16</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#f2241ca86c087f6aa41d060ebf3a0a2cb9dfd235" class="src_link" title="app/mailers/application_mailer.rb">app/mailers/application_mailer.rb</a></td>
            <td class="red strong cell--number t-file__coverage">0.00 %</td>
            <td class="cell--number">6</td>
            <td class="cell--number">4</td>
            <td class="cell--number">0</td>
            <td class="cell--number">4</td>
            <td class="cell--number">0.00</td>
            
              <td class="green strong cell--number t-file__branch-coverage">100.00 %</td>
              <td class="cell--number">0</td>
              <td class="cell--number">0</td>
              <td class="cell--number">0</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#8ed3c6ef508092e01d4cf7728b2a2eed16d49c4b" class="src_link" title="app/models/application_record.rb">app/models/application_record.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">5</td>
            <td class="cell--number">2</td>
            <td class="cell--number">2</td>
            <td class="cell--number">0</td>
            <td class="cell--number">1.00</td>
            
              <td class="green strong cell--number t-file__branch-coverage">100.00 %</td>
              <td class="cell--number">0</td>
              <td class="cell--number">0</td>
              <td class="cell--number">0</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#fe178d883ec92db2a6f188890376311fb395a481" class="src_link" title="app/models/customer.rb">app/models/customer.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">5</td>
            <td class="cell--number">2</td>
            <td class="cell--number">2</td>
            <td class="cell--number">0</td>
            <td class="cell--number">1.00</td>
            
              <td class="green strong cell--number t-file__branch-coverage">100.00 %</td>
              <td class="cell--number">0</td>
              <td class="cell--number">0</td>
              <td class="cell--number">0</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#d5b36ffb0fdb8e592bbb03d3fcb01ec95d63efbe" class="src_link" title="app/models/email_log.rb">app/models/email_log.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">7</td>
            <td class="cell--number">3</td>
            <td class="cell--number">3</td>
            <td class="cell--number">0</td>
            <td class="cell--number">1.00</td>
            
              <td class="green strong cell--number t-file__branch-coverage">100.00 %</td>
              <td class="cell--number">0</td>
              <td class="cell--number">0</td>
              <td class="cell--number">0</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#c2ea84266843c25e79d086508a1f3d7b26f87458" class="src_link" title="app/models/upload.rb">app/models/upload.rb</a></td>
            <td class="red strong cell--number t-file__coverage">31.25 %</td>
            <td class="cell--number">41</td>
            <td class="cell--number">16</td>
            <td class="cell--number">5</td>
            <td class="cell--number">11</td>
            <td class="cell--number">0.31</td>
            
              <td class="red strong cell--number t-file__branch-coverage">0.00 %</td>
              <td class="cell--number">8</td>
              <td class="cell--number">0</td>
              <td class="cell--number">8</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#08ccd42ac635b8057c6edb4aaa7b0a74d4bb8c22" class="src_link" title="app/services/email_processor.rb">app/services/email_processor.rb</a></td>
            <td class="red strong cell--number t-file__coverage">73.81 %</td>
            <td class="cell--number">81</td>
            <td class="cell--number">42</td>
            <td class="cell--number">31</td>
            <td class="cell--number">11</td>
            <td class="cell--number">0.76</td>
            
              <td class="red strong cell--number t-file__branch-coverage">50.00 %</td>
              <td class="cell--number">8</td>
              <td class="cell--number">4</td>
              <td class="cell--number">4</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#56a76ca0e031e0772af13d371e5ce0fe9fd633d0" class="src_link" title="app/services/parsers/fornecedor_a_parser.rb">app/services/parsers/fornecedor_a_parser.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">15</td>
            <td class="cell--number">4</td>
            <td class="cell--number">4</td>
            <td class="cell--number">0</td>
            <td class="cell--number">1.00</td>
            
              <td class="green strong cell--number t-file__branch-coverage">100.00 %</td>
              <td class="cell--number">0</td>
              <td class="cell--number">0</td>
              <td class="cell--number">0</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#8b7cb608140213323a546a1f87de3168f7a72b32" class="src_link" title="app/services/parsers/parceiro_b_parser.rb">app/services/parsers/parceiro_b_parser.rb</a></td>
            <td class="red strong cell--number t-file__coverage">60.00 %</td>
            <td class="cell--number">15</td>
            <td class="cell--number">5</td>
            <td class="cell--number">3</td>
            <td class="cell--number">2</td>
            <td class="cell--number">0.60</td>
            
              <td class="red strong cell--number t-file__branch-coverage">0.00 %</td>
              <td class="cell--number">8</td>
              <td class="cell--number">0</td>
              <td class="cell--number">8</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#7ffc7b4161f59f98d9d79393a1342a731565b80a" class="src_link" title="app/services/parsers/parser_base.rb">app/services/parsers/parser_base.rb</a></td>
            <td class="yellow strong cell--number t-file__coverage">83.33 %</td>
            <td class="cell--number">35</td>
            <td class="cell--number">18</td>
            <td class="cell--number">15</td>
            <td class="cell--number">3</td>
            <td class="cell--number">1.28</td>
            
              <td class="red strong cell--number t-file__branch-coverage">33.33 %</td>
              <td class="cell--number">6</td>
              <td class="cell--number">2</td>
              <td class="cell--number">4</td>
            
          </tr>
        
      </tbody>
    </table>
  </div>
</div>


        
          <div class="file_list_container" id="Controllers">
  <h2>
    <span class="group_name">Controllers</span>
    (<span class="covered_percent">
      <span class="red">
  33.67%
</span>

     </span>
     covered at
     <span class="covered_strength">
       <span class="red">
         0.57
       </span>
    </span> hits/line
    )
  </h2>

  <a name="Controllers"></a>

  <div>
    <b>5</b> files in total.
  </div>

  <div class="t-line-summary">
    <b>98</b> relevant lines,
    <span class="green"><b>33</b> lines covered</span> and
    <span class="red"><b>65</b> lines missed. </span>
    (<span class="red">
  33.67%
</span>
)
  </div>

  
    <div class="t-branch-summary">
      <span><b>14</b> total branches, </span>
      <span class="green"><b>4</b> branches covered</span> and
      <span class="red"><b>10</b> branches missed.</span>
      (<span class="red">
  28.57%
</span>
)
    </div>
  

  <div class="file_list--responsive">
    <table class="file_list">
      <thead>
        <tr>
          <th>File</th>
          <th class="cell--number">% covered</th>
          <th class="cell--number">Lines</th>
          <th class="cell--number">Relevant Lines</th>
          <th class="cell--number">Lines covered</th>
          <th class="cell--number">Lines missed</th>
          <th class="cell--number">Avg. Hits / Line</th>
          
            <th class="cell--number">Branch Coverage</th>
            <th class="cell--number">Branches</th>
            <th class="cell--number">Covered branches</th>
            <th class="cell--number">Missed branches </th>
          
        </tr>
      </thead>
      <tbody>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#6f25a249069c8a178c03cf938e71ea7952c3d9d7" class="src_link" title="app/controllers/application_controller.rb">app/controllers/application_controller.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">4</td>
            <td class="cell--number">1</td>
            <td class="cell--number">1</td>
            <td class="cell--number">0</td>
            <td class="cell--number">1.00</td>
            
              <td class="green strong cell--number t-file__branch-coverage">100.00 %</td>
              <td class="cell--number">0</td>
              <td class="cell--number">0</td>
              <td class="cell--number">0</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#28dc070c00ce99a1a465dd32179fa5d0655a660c" class="src_link" title="app/controllers/customers_controller.rb">app/controllers/customers_controller.rb</a></td>
            <td class="red strong cell--number t-file__coverage">0.00 %</td>
            <td class="cell--number">11</td>
            <td class="cell--number">8</td>
            <td class="cell--number">0</td>
            <td class="cell--number">8</td>
            <td class="cell--number">0.00</td>
            
              <td class="green strong cell--number t-file__branch-coverage">100.00 %</td>
              <td class="cell--number">0</td>
              <td class="cell--number">0</td>
              <td class="cell--number">0</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#554e6341cdf32c44da0971e5b05c9ff9409c6de1" class="src_link" title="app/controllers/email_logs_controller.rb">app/controllers/email_logs_controller.rb</a></td>
            <td class="red strong cell--number t-file__coverage">0.00 %</td>
            <td class="cell--number">38</td>
            <td class="cell--number">31</td>
            <td class="cell--number">0</td>
            <td class="cell--number">31</td>
            <td class="cell--number">0.00</td>
            
              <td class="green strong cell--number t-file__branch-coverage">100.00 %</td>
              <td class="cell--number">0</td>
              <td class="cell--number">0</td>
              <td class="cell--number">0</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#263ae34344ee20cd4c0ebc43c6f89344572d21c3" class="src_link" title="app/controllers/logs_controller.rb">app/controllers/logs_controller.rb</a></td>
            <td class="red strong cell--number t-file__coverage">0.00 %</td>
            <td class="cell--number">11</td>
            <td class="cell--number">8</td>
            <td class="cell--number">0</td>
            <td class="cell--number">8</td>
            <td class="cell--number">0.00</td>
            
              <td class="green strong cell--number t-file__branch-coverage">100.00 %</td>
              <td class="cell--number">0</td>
              <td class="cell--number">0</td>
              <td class="cell--number">0</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#cd1e38f3cbd5978b5a56932d7629b21265ce8a56" class="src_link" title="app/controllers/uploads_controller.rb">app/controllers/uploads_controller.rb</a></td>
            <td class="red strong cell--number t-file__coverage">64.00 %</td>
            <td class="cell--number">114</td>
            <td class="cell--number">50</td>
            <td class="cell--number">32</td>
            <td class="cell--number">18</td>
            <td class="cell--number">1.10</td>
            
              <td class="red strong cell--number t-file__branch-coverage">28.57 %</td>
              <td class="cell--number">14</td>
              <td class="cell--number">4</td>
              <td class="cell--number">10</td>
            
          </tr>
        
      </tbody>
    </table>
  </div>
</div>

        
          <div class="file_list_container" id="Channels">
  <h2>
    <span class="group_name">Channels</span>
    (<span class="covered_percent">
      <span class="red">
  0.0%
</span>

     </span>
     covered at
     <span class="covered_strength">
       <span class="red">
         0.0
       </span>
    </span> hits/line
    )
  </h2>

  <a name="Channels"></a>

  <div>
    <b>2</b> files in total.
  </div>

  <div class="t-line-summary">
    <b>8</b> relevant lines,
    <span class="green"><b>0</b> lines covered</span> and
    <span class="red"><b>8</b> lines missed. </span>
    (<span class="red">
  0.0%
</span>
)
  </div>

  
    <div class="t-branch-summary">
      <span><b>0</b> total branches, </span>
      <span class="green"><b>0</b> branches covered</span> and
      <span class="red"><b>0</b> branches missed.</span>
      (<span class="green">
  100.0%
</span>
)
    </div>
  

  <div class="file_list--responsive">
    <table class="file_list">
      <thead>
        <tr>
          <th>File</th>
          <th class="cell--number">% covered</th>
          <th class="cell--number">Lines</th>
          <th class="cell--number">Relevant Lines</th>
          <th class="cell--number">Lines covered</th>
          <th class="cell--number">Lines missed</th>
          <th class="cell--number">Avg. Hits / Line</th>
          
            <th class="cell--number">Branch Coverage</th>
            <th class="cell--number">Branches</th>
            <th class="cell--number">Covered branches</th>
            <th class="cell--number">Missed branches </th>
          
        </tr>
      </thead>
      <tbody>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#4b0b944644245afdb80fdd4aac7ee09453c55796" class="src_link" title="app/channels/application_cable/channel.rb">app/channels/application_cable/channel.rb</a></td>
            <td class="red strong cell--number t-file__coverage">0.00 %</td>
            <td class="cell--number">6</td>
            <td class="cell--number">4</td>
            <td class="cell--number">0</td>
            <td class="cell--number">4</td>
            <td class="cell--number">0.00</td>
            
              <td class="green strong cell--number t-file__branch-coverage">100.00 %</td>
              <td class="cell--number">0</td>
              <td class="cell--number">0</td>
              <td class="cell--number">0</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#8181a49ff6d7331e707f049341e8d92db1c6f454" class="src_link" title="app/channels/application_cable/connection.rb">app/channels/application_cable/connection.rb</a></td>
            <td class="red strong cell--number t-file__coverage">0.00 %</td>
            <td class="cell--number">6</td>
            <td class="cell--number">4</td>
            <td class="cell--number">0</td>
            <td class="cell--number">4</td>
            <td class="cell--number">0.00</td>
            
              <td class="green strong cell--number t-file__branch-coverage">100.00 %</td>
              <td class="cell--number">0</td>
              <td class="cell--number">0</td>
              <td class="cell--number">0</td>
            
          </tr>
        
      </tbody>
    </table>
  </div>
</div>

        
          <div class="file_list_container" id="Models">
  <h2>
    <span class="group_name">Models</span>
    (<span class="covered_percent">
      <span class="red">
  52.17%
</span>

     </span>
     covered at
     <span class="covered_strength">
       <span class="red">
         0.52
       </span>
    </span> hits/line
    )
  </h2>

  <a name="Models"></a>

  <div>
    <b>4</b> files in total.
  </div>

  <div class="t-line-summary">
    <b>23</b> relevant lines,
    <span class="green"><b>12</b> lines covered</span> and
    <span class="red"><b>11</b> lines missed. </span>
    (<span class="red">
  52.17%
</span>
)
  </div>

  
    <div class="t-branch-summary">
      <span><b>8</b> total branches, </span>
      <span class="green"><b>0</b> branches covered</span> and
      <span class="red"><b>8</b> branches missed.</span>
      (<span class="red">
  0.0%
</span>
)
    </div>
  

  <div class="file_list--responsive">
    <table class="file_list">
      <thead>
        <tr>
          <th>File</th>
          <th class="cell--number">% covered</th>
          <th class="cell--number">Lines</th>
          <th class="cell--number">Relevant Lines</th>
          <th class="cell--number">Lines covered</th>
          <th class="cell--number">Lines missed</th>
          <th class="cell--number">Avg. Hits / Line</th>
          
            <th class="cell--number">Branch Coverage</th>
            <th class="cell--number">Branches</th>
            <th class="cell--number">Covered branches</th>
            <th class="cell--number">Missed branches </th>
          
        </tr>
      </thead>
      <tbody>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#8ed3c6ef508092e01d4cf7728b2a2eed16d49c4b" class="src_link" title="app/models/application_record.rb">app/models/application_record.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">5</td>
            <td class="cell--number">2</td>
            <td class="cell--number">2</td>
            <td class="cell--number">0</td>
            <td class="cell--number">1.00</td>
            
              <td class="green strong cell--number t-file__branch-coverage">100.00 %</td>
              <td class="cell--number">0</td>
              <td class="cell--number">0</td>
              <td class="cell--number">0</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#fe178d883ec92db2a6f188890376311fb395a481" class="src_link" title="app/models/customer.rb">app/models/customer.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">5</td>
            <td class="cell--number">2</td>
            <td class="cell--number">2</td>
            <td class="cell--number">0</td>
            <td class="cell--number">1.00</td>
            
              <td class="green strong cell--number t-file__branch-coverage">100.00 %</td>
              <td class="cell--number">0</td>
              <td class="cell--number">0</td>
              <td class="cell--number">0</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#d5b36ffb0fdb8e592bbb03d3fcb01ec95d63efbe" class="src_link" title="app/models/email_log.rb">app/models/email_log.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">7</td>
            <td class="cell--number">3</td>
            <td class="cell--number">3</td>
            <td class="cell--number">0</td>
            <td class="cell--number">1.00</td>
            
              <td class="green strong cell--number t-file__branch-coverage">100.00 %</td>
              <td class="cell--number">0</td>
              <td class="cell--number">0</td>
              <td class="cell--number">0</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#c2ea84266843c25e79d086508a1f3d7b26f87458" class="src_link" title="app/models/upload.rb">app/models/upload.rb</a></td>
            <td class="red strong cell--number t-file__coverage">31.25 %</td>
            <td class="cell--number">41</td>
            <td class="cell--number">16</td>
            <td class="cell--number">5</td>
            <td class="cell--number">11</td>
            <td class="cell--number">0.31</td>
            
              <td class="red strong cell--number t-file__branch-coverage">0.00 %</td>
              <td class="cell--number">8</td>
              <td class="cell--number">0</td>
              <td class="cell--number">8</td>
            
          </tr>
        
      </tbody>
    </table>
  </div>
</div>

        
          <div class="file_list_container" id="Mailers">
  <h2>
    <span class="group_name">Mailers</span>
    (<span class="covered_percent">
      <span class="red">
  0.0%
</span>

     </span>
     covered at
     <span class="covered_strength">
       <span class="red">
         0.0
       </span>
    </span> hits/line
    )
  </h2>

  <a name="Mailers"></a>

  <div>
    <b>1</b> files in total.
  </div>

  <div class="t-line-summary">
    <b>4</b> relevant lines,
    <span class="green"><b>0</b> lines covered</span> and
    <span class="red"><b>4</b> lines missed. </span>
    (<span class="red">
  0.0%
</span>
)
  </div>

  
    <div class="t-branch-summary">
      <span><b>0</b> total branches, </span>
      <span class="green"><b>0</b> branches covered</span> and
      <span class="red"><b>0</b> branches missed.</span>
      (<span class="green">
  100.0%
</span>
)
    </div>
  

  <div class="file_list--responsive">
    <table class="file_list">
      <thead>
        <tr>
          <th>File</th>
          <th class="cell--number">% covered</th>
          <th class="cell--number">Lines</th>
          <th class="cell--number">Relevant Lines</th>
          <th class="cell--number">Lines covered</th>
          <th class="cell--number">Lines missed</th>
          <th class="cell--number">Avg. Hits / Line</th>
          
            <th class="cell--number">Branch Coverage</th>
            <th class="cell--number">Branches</th>
            <th class="cell--number">Covered branches</th>
            <th class="cell--number">Missed branches </th>
          
        </tr>
      </thead>
      <tbody>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#f2241ca86c087f6aa41d060ebf3a0a2cb9dfd235" class="src_link" title="app/mailers/application_mailer.rb">app/mailers/application_mailer.rb</a></td>
            <td class="red strong cell--number t-file__coverage">0.00 %</td>
            <td class="cell--number">6</td>
            <td class="cell--number">4</td>
            <td class="cell--number">0</td>
            <td class="cell--number">4</td>
            <td class="cell--number">0.00</td>
            
              <td class="green strong cell--number t-file__branch-coverage">100.00 %</td>
              <td class="cell--number">0</td>
              <td class="cell--number">0</td>
              <td class="cell--number">0</td>
            
          </tr>
        
      </tbody>
    </table>
  </div>
</div>

        
          <div class="file_list_container" id="Helpers">
  <h2>
    <span class="group_name">Helpers</span>
    (<span class="covered_percent">
      <span class="green">
  100.0%
</span>

     </span>
     covered at
     <span class="covered_strength">
       <span class="yellow">
         1.0
       </span>
    </span> hits/line
    )
  </h2>

  <a name="Helpers"></a>

  <div>
    <b>1</b> files in total.
  </div>

  <div class="t-line-summary">
    <b>1</b> relevant lines,
    <span class="green"><b>1</b> lines covered</span> and
    <span class="red"><b>0</b> lines missed. </span>
    (<span class="green">
  100.0%
</span>
)
  </div>

  
    <div class="t-branch-summary">
      <span><b>0</b> total branches, </span>
      <span class="green"><b>0</b> branches covered</span> and
      <span class="red"><b>0</b> branches missed.</span>
      (<span class="green">
  100.0%
</span>
)
    </div>
  

  <div class="file_list--responsive">
    <table class="file_list">
      <thead>
        <tr>
          <th>File</th>
          <th class="cell--number">% covered</th>
          <th class="cell--number">Lines</th>
          <th class="cell--number">Relevant Lines</th>
          <th class="cell--number">Lines covered</th>
          <th class="cell--number">Lines missed</th>
          <th class="cell--number">Avg. Hits / Line</th>
          
            <th class="cell--number">Branch Coverage</th>
            <th class="cell--number">Branches</th>
            <th class="cell--number">Covered branches</th>
            <th class="cell--number">Missed branches </th>
          
        </tr>
      </thead>
      <tbody>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#0537408f1b7bd07757ef3ef19a7d949a1b6f9767" class="src_link" title="app/helpers/application_helper.rb">app/helpers/application_helper.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">4</td>
            <td class="cell--number">1</td>
            <td class="cell--number">1</td>
            <td class="cell--number">0</td>
            <td class="cell--number">1.00</td>
            
              <td class="green strong cell--number t-file__branch-coverage">100.00 %</td>
              <td class="cell--number">0</td>
              <td class="cell--number">0</td>
              <td class="cell--number">0</td>
            
          </tr>
        
      </tbody>
    </table>
  </div>
</div>

        
          <div class="file_list_container" id="Jobs">
  <h2>
    <span class="group_name">Jobs</span>
    (<span class="covered_percent">
      <span class="red">
  12.77%
</span>

     </span>
     covered at
     <span class="covered_strength">
       <span class="red">
         0.13
       </span>
    </span> hits/line
    )
  </h2>

  <a name="Jobs"></a>

  <div>
    <b>3</b> files in total.
  </div>

  <div class="t-line-summary">
    <b>47</b> relevant lines,
    <span class="green"><b>6</b> lines covered</span> and
    <span class="red"><b>41</b> lines missed. </span>
    (<span class="red">
  12.77%
</span>
)
  </div>

  
    <div class="t-branch-summary">
      <span><b>16</b> total branches, </span>
      <span class="green"><b>0</b> branches covered</span> and
      <span class="red"><b>16</b> branches missed.</span>
      (<span class="red">
  0.0%
</span>
)
    </div>
  

  <div class="file_list--responsive">
    <table class="file_list">
      <thead>
        <tr>
          <th>File</th>
          <th class="cell--number">% covered</th>
          <th class="cell--number">Lines</th>
          <th class="cell--number">Relevant Lines</th>
          <th class="cell--number">Lines covered</th>
          <th class="cell--number">Lines missed</th>
          <th class="cell--number">Avg. Hits / Line</th>
          
            <th class="cell--number">Branch Coverage</th>
            <th class="cell--number">Branches</th>
            <th class="cell--number">Covered branches</th>
            <th class="cell--number">Missed branches </th>
          
        </tr>
      </thead>
      <tbody>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#cbc3afba71da952ac69800a388d5e0f6b1654554" class="src_link" title="app/jobs/application_job.rb">app/jobs/application_job.rb</a></td>
            <td class="red strong cell--number t-file__coverage">75.00 %</td>
            <td class="cell--number">18</td>
            <td class="cell--number">4</td>
            <td class="cell--number">3</td>
            <td class="cell--number">1</td>
            <td class="cell--number">0.75</td>
            
              <td class="green strong cell--number t-file__branch-coverage">100.00 %</td>
              <td class="cell--number">0</td>
              <td class="cell--number">0</td>
              <td class="cell--number">0</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#d01bea3a02c1dbab7b460e99b0e9b144898919a7" class="src_link" title="app/jobs/process_email_job.rb">app/jobs/process_email_job.rb</a></td>
            <td class="red strong cell--number t-file__coverage">0.00 %</td>
            <td class="cell--number">24</td>
            <td class="cell--number">17</td>
            <td class="cell--number">0</td>
            <td class="cell--number">17</td>
            <td class="cell--number">0.00</td>
            
              <td class="green strong cell--number t-file__branch-coverage">100.00 %</td>
              <td class="cell--number">0</td>
              <td class="cell--number">0</td>
              <td class="cell--number">0</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#95356d33c21b0e24cd315f2c802349ba8ed590d0" class="src_link" title="app/jobs/process_upload_job.rb">app/jobs/process_upload_job.rb</a></td>
            <td class="red strong cell--number t-file__coverage">11.54 %</td>
            <td class="cell--number">53</td>
            <td class="cell--number">26</td>
            <td class="cell--number">3</td>
            <td class="cell--number">23</td>
            <td class="cell--number">0.12</td>
            
              <td class="red strong cell--number t-file__branch-coverage">0.00 %</td>
              <td class="cell--number">16</td>
              <td class="cell--number">0</td>
              <td class="cell--number">16</td>
            
          </tr>
        
      </tbody>
    </table>
  </div>
</div>

        
          <div class="file_list_container" id="Libraries">
  <h2>
    <span class="group_name">Libraries</span>
    (<span class="covered_percent">
      <span class="green">
  100.0%
</span>

     </span>
     covered at
     <span class="covered_strength">
       <span class="red">
         0.0
       </span>
    </span> hits/line
    )
  </h2>

  <a name="Libraries"></a>

  <div>
    <b>0</b> files in total.
  </div>

  <div class="t-line-summary">
    <b>0</b> relevant lines,
    <span class="green"><b>0</b> lines covered</span> and
    <span class="red"><b>0</b> lines missed. </span>
    (<span class="green">
  100.0%
</span>
)
  </div>

  
    <div class="t-branch-summary">
      <span><b>0</b> total branches, </span>
      <span class="green"><b>0</b> branches covered</span> and
      <span class="red"><b>0</b> branches missed.</span>
      (<span class="green">
  100.0%
</span>
)
    </div>
  

  <div class="file_list--responsive">
    <table class="file_list">
      <thead>
        <tr>
          <th>File</th>
          <th class="cell--number">% covered</th>
          <th class="cell--number">Lines</th>
          <th class="cell--number">Relevant Lines</th>
          <th class="cell--number">Lines covered</th>
          <th class="cell--number">Lines missed</th>
          <th class="cell--number">Avg. Hits / Line</th>
          
            <th class="cell--number">Branch Coverage</th>
            <th class="cell--number">Branches</th>
            <th class="cell--number">Covered branches</th>
            <th class="cell--number">Missed branches </th>
          
        </tr>
      </thead>
      <tbody>
        
      </tbody>
    </table>
  </div>
</div>

        
          <div class="file_list_container" id="Ungrouped">
  <h2>
    <span class="group_name">Ungrouped</span>
    (<span class="covered_percent">
      <span class="red">
  76.81%
</span>

     </span>
     covered at
     <span class="covered_strength">
       <span class="red">
         0.9
       </span>
    </span> hits/line
    )
  </h2>

  <a name="Ungrouped"></a>

  <div>
    <b>4</b> files in total.
  </div>

  <div class="t-line-summary">
    <b>69</b> relevant lines,
    <span class="green"><b>53</b> lines covered</span> and
    <span class="red"><b>16</b> lines missed. </span>
    (<span class="red">
  76.81%
</span>
)
  </div>

  
    <div class="t-branch-summary">
      <span><b>22</b> total branches, </span>
      <span class="green"><b>6</b> branches covered</span> and
      <span class="red"><b>16</b> branches missed.</span>
      (<span class="red">
  27.27%
</span>
)
    </div>
  

  <div class="file_list--responsive">
    <table class="file_list">
      <thead>
        <tr>
          <th>File</th>
          <th class="cell--number">% covered</th>
          <th class="cell--number">Lines</th>
          <th class="cell--number">Relevant Lines</th>
          <th class="cell--number">Lines covered</th>
          <th class="cell--number">Lines missed</th>
          <th class="cell--number">Avg. Hits / Line</th>
          
            <th class="cell--number">Branch Coverage</th>
            <th class="cell--number">Branches</th>
            <th class="cell--number">Covered branches</th>
            <th class="cell--number">Missed branches </th>
          
        </tr>
      </thead>
      <tbody>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#08ccd42ac635b8057c6edb4aaa7b0a74d4bb8c22" class="src_link" title="app/services/email_processor.rb">app/services/email_processor.rb</a></td>
            <td class="red strong cell--number t-file__coverage">73.81 %</td>
            <td class="cell--number">81</td>
            <td class="cell--number">42</td>
            <td class="cell--number">31</td>
            <td class="cell--number">11</td>
            <td class="cell--number">0.76</td>
            
              <td class="red strong cell--number t-file__branch-coverage">50.00 %</td>
              <td class="cell--number">8</td>
              <td class="cell--number">4</td>
              <td class="cell--number">4</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#56a76ca0e031e0772af13d371e5ce0fe9fd633d0" class="src_link" title="app/services/parsers/fornecedor_a_parser.rb">app/services/parsers/fornecedor_a_parser.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">15</td>
            <td class="cell--number">4</td>
            <td class="cell--number">4</td>
            <td class="cell--number">0</td>
            <td class="cell--number">1.00</td>
            
              <td class="green strong cell--number t-file__branch-coverage">100.00 %</td>
              <td class="cell--number">0</td>
              <td class="cell--number">0</td>
              <td class="cell--number">0</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#8b7cb608140213323a546a1f87de3168f7a72b32" class="src_link" title="app/services/parsers/parceiro_b_parser.rb">app/services/parsers/parceiro_b_parser.rb</a></td>
            <td class="red strong cell--number t-file__coverage">60.00 %</td>
            <td class="cell--number">15</td>
            <td class="cell--number">5</td>
            <td class="cell--number">3</td>
            <td class="cell--number">2</td>
            <td class="cell--number">0.60</td>
            
              <td class="red strong cell--number t-file__branch-coverage">0.00 %</td>
              <td class="cell--number">8</td>
              <td class="cell--number">0</td>
              <td class="cell--number">8</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#7ffc7b4161f59f98d9d79393a1342a731565b80a" class="src_link" title="app/services/parsers/parser_base.rb">app/services/parsers/parser_base.rb</a></td>
            <td class="yellow strong cell--number t-file__coverage">83.33 %</td>
            <td class="cell--number">35</td>
            <td class="cell--number">18</td>
            <td class="cell--number">15</td>
            <td class="cell--number">3</td>
            <td class="cell--number">1.28</td>
            
              <td class="red strong cell--number t-file__branch-coverage">33.33 %</td>
              <td class="cell--number">6</td>
              <td class="cell--number">2</td>
              <td class="cell--number">4</td>
            
          </tr>
        
      </tbody>
    </table>
  </div>
</div>

        
      </div>

      <div id="footer">
        Generated by <a href="https://github.com/simplecov-ruby/simplecov">simplecov</a> v0.22.0
        and simplecov-html v0.13.2<br/>
        using RSpec
      </div>

      <div class="source_files">
      
        <div class="source_table" id="4b0b944644245afdb80fdd4aac7ee09453c55796">
  <div class="header">
    <h3>app/channels/application_cable/channel.rb</h3>
    <h4>
      <span class="red">
  0.0%
</span>

      lines covered
    </h4>

    
      <h4>
        <span class="green">
  100.0%
</span>

        branches covered
      </h4>
    

    <div class="t-line-summary">
      <b>4</b> relevant lines.
      <span class="green"><b>0</b> lines covered</span> and
      <span class="red"><b>4</b> lines missed.</span>
    </div>

    
      <div class="t-branch-summary">
          <span><b>0</b> total branches, </span>
          <span class="green"><b>0</b> branches covered</span> and
          <span class="red"><b>0</b> branches missed.</span>
      </div>
    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="never" data-hits="" data-linenumber="1">
            

            
              
            

            <code class="ruby"># frozen_string_literal: true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="2">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="3">
            

            
              
            

            <code class="ruby">module ApplicationCable</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="4">
            

            
              
            

            <code class="ruby">  class Channel &lt; ActionCable::Channel::Base</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="5">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="6">
            

            
              
            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="8181a49ff6d7331e707f049341e8d92db1c6f454">
  <div class="header">
    <h3>app/channels/application_cable/connection.rb</h3>
    <h4>
      <span class="red">
  0.0%
</span>

      lines covered
    </h4>

    
      <h4>
        <span class="green">
  100.0%
</span>

        branches covered
      </h4>
    

    <div class="t-line-summary">
      <b>4</b> relevant lines.
      <span class="green"><b>0</b> lines covered</span> and
      <span class="red"><b>4</b> lines missed.</span>
    </div>

    
      <div class="t-branch-summary">
          <span><b>0</b> total branches, </span>
          <span class="green"><b>0</b> branches covered</span> and
          <span class="red"><b>0</b> branches missed.</span>
      </div>
    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="never" data-hits="" data-linenumber="1">
            

            
              
            

            <code class="ruby"># frozen_string_literal: true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="2">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="3">
            

            
              
            

            <code class="ruby">module ApplicationCable</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="4">
            

            
              
            

            <code class="ruby">  class Connection &lt; ActionCable::Connection::Base</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="5">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="6">
            

            
              
            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="6f25a249069c8a178c03cf938e71ea7952c3d9d7">
  <div class="header">
    <h3>app/controllers/application_controller.rb</h3>
    <h4>
      <span class="green">
  100.0%
</span>

      lines covered
    </h4>

    
      <h4>
        <span class="green">
  100.0%
</span>

        branches covered
      </h4>
    

    <div class="t-line-summary">
      <b>1</b> relevant lines.
      <span class="green"><b>1</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>

    
      <div class="t-branch-summary">
          <span><b>0</b> total branches, </span>
          <span class="green"><b>0</b> branches covered</span> and
          <span class="red"><b>0</b> branches missed.</span>
      </div>
    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="never" data-hits="" data-linenumber="1">
            

            
              
            

            <code class="ruby"># frozen_string_literal: true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="2">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="3">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">class ApplicationController &lt; ActionController::Base</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="4">
            

            
              
            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="28dc070c00ce99a1a465dd32179fa5d0655a660c">
  <div class="header">
    <h3>app/controllers/customers_controller.rb</h3>
    <h4>
      <span class="red">
  0.0%
</span>

      lines covered
    </h4>

    
      <h4>
        <span class="green">
  100.0%
</span>

        branches covered
      </h4>
    

    <div class="t-line-summary">
      <b>8</b> relevant lines.
      <span class="green"><b>0</b> lines covered</span> and
      <span class="red"><b>8</b> lines missed.</span>
    </div>

    
      <div class="t-branch-summary">
          <span><b>0</b> total branches, </span>
          <span class="green"><b>0</b> branches covered</span> and
          <span class="red"><b>0</b> branches missed.</span>
      </div>
    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="never" data-hits="" data-linenumber="1">
            

            
              
            

            <code class="ruby"># frozen_string_literal: true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="2">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="3">
            

            
              
            

            <code class="ruby">class CustomersController &lt; ApplicationController # rubocop:disable Style/Documentation</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="4">
            

            
              
            

            <code class="ruby">  def index</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="5">
            

            
              
            

            <code class="ruby">    @customers = Customer.order(created_at: :desc).limit(100)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="6">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="7">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="8">
            

            
              
            

            <code class="ruby">  def show</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="9">
            

            
              
            

            <code class="ruby">    @customer = Customer.find(params[:id])</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="10">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="11">
            

            
              
            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="554e6341cdf32c44da0971e5b05c9ff9409c6de1">
  <div class="header">
    <h3>app/controllers/email_logs_controller.rb</h3>
    <h4>
      <span class="red">
  0.0%
</span>

      lines covered
    </h4>

    
      <h4>
        <span class="green">
  100.0%
</span>

        branches covered
      </h4>
    

    <div class="t-line-summary">
      <b>31</b> relevant lines.
      <span class="green"><b>0</b> lines covered</span> and
      <span class="red"><b>31</b> lines missed.</span>
    </div>

    
      <div class="t-branch-summary">
          <span><b>0</b> total branches, </span>
          <span class="green"><b>0</b> branches covered</span> and
          <span class="red"><b>0</b> branches missed.</span>
      </div>
    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="never" data-hits="" data-linenumber="1">
            

            
              
            

            <code class="ruby"># frozen_string_literal: true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="2">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="3">
            

            
              
            

            <code class="ruby">class EmailLogsController &lt; ApplicationController # rubocop:disable Style/Documentation</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="4">
            

            
              
            

            <code class="ruby">  def raw # rubocop:disable Metrics/MethodLength, Metrics/AbcSize</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="5">
            

            
              
            

            <code class="ruby">    email_log = EmailLog.find_by(id: params[:id])</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="6">
            

            
              
            

            <code class="ruby">    return head :not_found unless email_log</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="7">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="8">
            

            
              
            

            <code class="ruby">    raw = (email_log.raw_data || &#39;&#39;).dup</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="9">
            

            
              
            

            <code class="ruby">    utf8 = begin</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="10">
            

            
              
            

            <code class="ruby">      if raw.encoding == Encoding::UTF_8 &amp;&amp; raw.valid_encoding?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="11">
            

            
              
            

            <code class="ruby">        raw</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="12">
            

            
              
            

            <code class="ruby">      else</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="13">
            

            
              
            

            <code class="ruby">        raw = raw.force_encoding(&#39;BINARY&#39;) unless raw.frozen?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="14">
            

            
              
            

            <code class="ruby">        raw.encode(&#39;UTF-8&#39;, invalid: :replace, undef: :replace, replace: &#39;&#39;)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="15">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="16">
            

            
              
            

            <code class="ruby">    rescue StandardError =&gt; _e</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="17">
            

            
              
            

            <code class="ruby">      raw.to_s.force_encoding(&#39;BINARY&#39;).encode(&#39;UTF-8&#39;, invalid: :replace, undef: :replace, replace: &#39;&#39;)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="18">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="19">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="20">
            

            
              
            

            <code class="ruby">    render json: {</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="21">
            

            
              
            

            <code class="ruby">      id: email_log.id,</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="22">
            

            
              
            

            <code class="ruby">      file_name: email_log.file_name,</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="23">
            

            
              
            

            <code class="ruby">      status: email_log.status,</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="24">
            

            
              
            

            <code class="ruby">      raw: utf8</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="25">
            

            
              
            

            <code class="ruby">    }</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="26">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="27">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="28">
            

            
              
            

            <code class="ruby">  def clear_raw</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="29">
            

            
              
            

            <code class="ruby">    email_log = EmailLog.find_by(id: params[:id])</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="30">
            

            
              
            

            <code class="ruby">    return render json: { error: &#39;Not found&#39; }, status: 404 unless email_log</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="31">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="32">
            

            
              
            

            <code class="ruby">    email_log.update!(</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="33">
            

            
              
            

            <code class="ruby">      raw_data: nil</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="34">
            

            
              
            

            <code class="ruby">    )</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="35">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="36">
            

            
              
            

            <code class="ruby">    render json: { success: true }</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="37">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="38">
            

            
              
            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="263ae34344ee20cd4c0ebc43c6f89344572d21c3">
  <div class="header">
    <h3>app/controllers/logs_controller.rb</h3>
    <h4>
      <span class="red">
  0.0%
</span>

      lines covered
    </h4>

    
      <h4>
        <span class="green">
  100.0%
</span>

        branches covered
      </h4>
    

    <div class="t-line-summary">
      <b>8</b> relevant lines.
      <span class="green"><b>0</b> lines covered</span> and
      <span class="red"><b>8</b> lines missed.</span>
    </div>

    
      <div class="t-branch-summary">
          <span><b>0</b> total branches, </span>
          <span class="green"><b>0</b> branches covered</span> and
          <span class="red"><b>0</b> branches missed.</span>
      </div>
    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="never" data-hits="" data-linenumber="1">
            

            
              
            

            <code class="ruby"># frozen_string_literal: true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="2">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="3">
            

            
              
            

            <code class="ruby">class LogsController &lt; ApplicationController # rubocop:disable Style/Documentation</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="4">
            

            
              
            

            <code class="ruby">  def index</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="5">
            

            
              
            

            <code class="ruby">    @logs = EmailLog.order(created_at: :desc).limit(200)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="6">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="7">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="8">
            

            
              
            

            <code class="ruby">  def show</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="9">
            

            
              
            

            <code class="ruby">    @log = EmailLog.find(params[:id])</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="10">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="11">
            

            
              
            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="cd1e38f3cbd5978b5a56932d7629b21265ce8a56">
  <div class="header">
    <h3>app/controllers/uploads_controller.rb</h3>
    <h4>
      <span class="red">
  64.0%
</span>

      lines covered
    </h4>

    
      <h4>
        <span class="red">
  28.57%
</span>

        branches covered
      </h4>
    

    <div class="t-line-summary">
      <b>50</b> relevant lines.
      <span class="green"><b>32</b> lines covered</span> and
      <span class="red"><b>18</b> lines missed.</span>
    </div>

    
      <div class="t-branch-summary">
          <span><b>14</b> total branches, </span>
          <span class="green"><b>4</b> branches covered</span> and
          <span class="red"><b>10</b> branches missed.</span>
      </div>
    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="never" data-hits="" data-linenumber="1">
            

            
              
            

            <code class="ruby"># frozen_string_literal: true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="2">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="3">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">class UploadsController &lt; ApplicationController # rubocop:disable Style/Documentation</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="4">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">  def index</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="5">
            

            
              
            

            <code class="ruby">    @logs = EmailLog.order(created_at: :desc).limit(100)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="6">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="7">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="8">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">  def new</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="9">
            

            
              
            

            <code class="ruby">    @uploads = Upload.order(created_at: :desc).limit(50)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="10">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="11">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="12">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">  def create # rubocop:disable Metrics/MethodLength, Metrics/AbcSize</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="13">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    files = params[:eml_files]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="14">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="1" data-linenumber="15">
            
              <span class="hits">1</span>
            

            
              
                <span class="hits" title="else branch hit 1 times">
                  else: 1
                </span>
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
            

            <code class="ruby">    redirect_to new_upload_path, alert: &#39;Escolha ao menos um arquivo .eml&#39; and return unless files.present?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="16">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="17">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    upload = Upload.create!(files_count: 0, status: &#39;processing&#39;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="18">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="19">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    saved_ids = []</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="20">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="21">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    files.each do |file|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="22">
            
              <span class="hits">3</span>
            

            
              
            

            <code class="ruby">      raw_bytes = file.read</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="23">
            
              <span class="hits">3</span>
            

            
              
            

            <code class="ruby">      raw_utf8 = safe_convert_to_utf8(raw_bytes)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="24">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="25">
            
              <span class="hits">3</span>
            

            
              
            

            <code class="ruby">      email_log = EmailLog.create!(</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="26">
            

            
              
            

            <code class="ruby">        upload_id: upload.id,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="27">
            

            
              
            

            <code class="ruby">        file_name: file.original_filename,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="28">
            

            
              
            

            <code class="ruby">        raw_data: raw_utf8,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="29">
            

            
              
            

            <code class="ruby">        status: &#39;pending&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="30">
            

            
              
            

            <code class="ruby">      )</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="31">
            
              <span class="hits">3</span>
            

            
              
            

            <code class="ruby">      saved_ids &lt;&lt; email_log.id</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="32">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="33">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="34">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    upload.update!(files_count: saved_ids.size)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="35">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    ProcessUploadJob.perform_later(upload.id)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="36">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="37">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    redirect_to upload_path(upload), notice: &quot;#{saved_ids.size} arquivo(s) enviados.&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="38">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="39">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="40">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">  def show</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="41">
            

            
              
            

            <code class="ruby">    @upload = Upload.find(params[:id])</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="42">
            

            
              
            

            <code class="ruby">    @logs = @upload.email_logs.order(created_at: :desc)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="43">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="44">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="45">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">  def logs_json # rubocop:disable Metrics/MethodLength, Metrics/AbcSize</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="46">
            

            
              
            

            <code class="ruby">    @upload = Upload.find(params[:id])</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="47">
            

            
              
            

            <code class="ruby">    @logs = @upload.email_logs.order(created_at: :desc)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="48">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="49">
            

            
              
            

            <code class="ruby">    render json: {</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="50">
            

            
              
            

            <code class="ruby">      logs: @logs.map do |log|</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="51">
            

            
              
            

            <code class="ruby">        {</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="52">
            

            
              
            

            <code class="ruby">          id: log.id,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="53">
            

            
              
            

            <code class="ruby">          status: log.status,</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="" data-linenumber="54">
            

            
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">          file_name: log&amp;.file_name,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="55">
            

            
              
            

            <code class="ruby">          message: log.message,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="56">
            

            
              
            

            <code class="ruby">          parsed_json: log.parsed_json || {},</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="57">
            

            
              
            

            <code class="ruby">          created_at: log.created_at.strftime(&#39;%d/%m/%Y %H:%M:%S&#39;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="58">
            

            
              
            

            <code class="ruby">        }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="59">
            

            
              
            

            <code class="ruby">      end,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="60">
            

            
              
            

            <code class="ruby">      upload_status: @upload.status,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="61">
            

            
              
            

            <code class="ruby">      total_files: @upload.files_count,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="62">
            

            
              
            

            <code class="ruby">      processed_files: @logs.count</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="63">
            

            
              
            

            <code class="ruby">    }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="64">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="65">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="66">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">  def clear_email_logs_raw</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="67">
            
              <span class="hits">4</span>
            

            
              
            

            <code class="ruby">    upload = Upload.find_by(id: params[:id])</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="68">
            
              <span class="hits">4</span>
            

            
              
                <span class="hits" title="else branch hit 3 times">
                  else: 3
                </span>
              
                <span class="hits" title="then branch hit 1 times">
                  then: 1
                </span>
              
            

            <code class="ruby">    return render json: { success: false, error: &#39;Upload not found&#39; }, status: :not_found unless upload</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="69">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="70">
            

            
              
            

            <code class="ruby">    begin</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="71">
            
              <span class="hits">3</span>
            

            
              
            

            <code class="ruby">      upload.email_logs.update_all(raw_data: nil, message: nil, parsed_json: {})</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="72">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="73">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">      render json: { success: true, cleared: upload.email_logs.count }</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="74">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    rescue StandardError =&gt; e</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="75">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      Rails.logger.error(&quot;[UploadsController#clear_email_logs_raw] upload=#{upload.id} error: #{e.class}: #{e.message}&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="76">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      render json: { success: false, error: e.message }, status: :internal_server_error</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="77">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="78">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="79">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="80">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">  private</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="81">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="82">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">  def safe_convert_to_utf8(raw)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="83">
            

            
              
            

            <code class="ruby">    begin</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="84">
            
              <span class="hits">3</span>
            

            
              
            

            <code class="ruby">      require &#39;charlock_holmes&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="85">
            
              <span class="hits">3</span>
            

            
              
            

            <code class="ruby">      detection = CharlockHolmes::EncodingDetector.detect(raw)</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="3" data-linenumber="86">
            
              <span class="hits">3</span>
            

            
              
                <span class="hits" title="then branch hit 3 times">
                  then: 3
                </span>
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">      return CharlockHolmes::Converter.convert(raw, detection[:encoding], &#39;UTF-8&#39;) if detection &amp;&amp; detection[:encoding]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="87">
            

            
              
            

            <code class="ruby">    rescue StandardError =&gt; e</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="88">
            

            
              
            

            <code class="ruby">      Rails.logger.warn(&quot;[UploadsController] charlock error: #{e.class}: #{e.message}&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="89">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="90">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="91">
            

            
              
            

            <code class="ruby">    encode_with_heuristics(raw)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="92">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="93">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="94">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">  def encode_with_heuristics(raw) # rubocop:disable Metrics/MethodLength</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="0" data-linenumber="95">
            

            
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">    return raw if raw.encoding == Encoding::UTF_8 &amp;&amp; raw.valid_encoding?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="96">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="97">
            

            
              
            

            <code class="ruby">    bin = raw.dup.force_encoding(&#39;BINARY&#39;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="98">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="99">
            

            
              
            

            <code class="ruby">    begin</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="100">
            

            
              
            

            <code class="ruby">      utf8 = bin.encode(&#39;UTF-8&#39;)</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="0" data-linenumber="101">
            

            
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">      return utf8 if utf8.valid_encoding?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="102">
            

            
              
            

            <code class="ruby">    rescue Encoding::InvalidByteSequenceError, Encoding::UndefinedConversionError # rubocop:disable Lint/SuppressedException</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="103">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="104">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="105">
            

            
              
            

            <code class="ruby">    begin</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="106">
            

            
              
            

            <code class="ruby">      iso = raw.dup.force_encoding(&#39;ISO-8859-1&#39;)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="107">
            

            
              
            

            <code class="ruby">      utf8_from_iso = iso.encode(&#39;UTF-8&#39;, invalid: :replace, undef: :replace, replace: &#39;&#39;)</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="0" data-linenumber="108">
            

            
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">      return utf8_from_iso if utf8_from_iso.valid_encoding?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="109">
            

            
              
            

            <code class="ruby">    rescue StandardError =&gt; _e # rubocop:disable Lint/SuppressedException</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="110">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="111">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="112">
            

            
              
            

            <code class="ruby">    raw.dup.force_encoding(&#39;BINARY&#39;).encode(&#39;UTF-8&#39;, invalid: :replace, undef: :replace, replace: &#39;&#39;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="113">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="114">
            

            
              
            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="0537408f1b7bd07757ef3ef19a7d949a1b6f9767">
  <div class="header">
    <h3>app/helpers/application_helper.rb</h3>
    <h4>
      <span class="green">
  100.0%
</span>

      lines covered
    </h4>

    
      <h4>
        <span class="green">
  100.0%
</span>

        branches covered
      </h4>
    

    <div class="t-line-summary">
      <b>1</b> relevant lines.
      <span class="green"><b>1</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>

    
      <div class="t-branch-summary">
          <span><b>0</b> total branches, </span>
          <span class="green"><b>0</b> branches covered</span> and
          <span class="red"><b>0</b> branches missed.</span>
      </div>
    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="never" data-hits="" data-linenumber="1">
            

            
              
            

            <code class="ruby"># frozen_string_literal: true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="2">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="3">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">module ApplicationHelper # rubocop:disable Style/Documentation</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="4">
            

            
              
            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="cbc3afba71da952ac69800a388d5e0f6b1654554">
  <div class="header">
    <h3>app/jobs/application_job.rb</h3>
    <h4>
      <span class="red">
  75.0%
</span>

      lines covered
    </h4>

    
      <h4>
        <span class="green">
  100.0%
</span>

        branches covered
      </h4>
    

    <div class="t-line-summary">
      <b>4</b> relevant lines.
      <span class="green"><b>3</b> lines covered</span> and
      <span class="red"><b>1</b> lines missed.</span>
    </div>

    
      <div class="t-branch-summary">
          <span><b>0</b> total branches, </span>
          <span class="green"><b>0</b> branches covered</span> and
          <span class="red"><b>0</b> branches missed.</span>
      </div>
    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="never" data-hits="" data-linenumber="1">
            

            
              
            

            <code class="ruby"># frozen_string_literal: true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="2">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="3">
            

            
              
            

            <code class="ruby"># app/jobs/application_job.rb</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="4">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">class ApplicationJob &lt; ActiveJob::Base</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="5">
            

            
              
            

            <code class="ruby">  # Automatically retry jobs that encountered a deadlock</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="6">
            

            
              
            

            <code class="ruby">  # retry_on ActiveRecord::Deadlocked</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="7">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="8">
            

            
              
            

            <code class="ruby">  # Most jobs are safe to ignore if the underlying records are no longer available</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="9">
            

            
              
            

            <code class="ruby">  # discard_on ActiveJob::DeserializationError</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="10">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="11">
            

            
              
            

            <code class="ruby">  # Compatibilidade: permite que cdigo que chama perform_async continue funcionando</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="12">
            

            
              
            

            <code class="ruby">  # (delegando para perform_later do ActiveJob)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="13">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">  class &lt;&lt; self</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="14">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    def perform_async(*args)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="15">
            

            
              
            

            <code class="ruby">      perform_later(*args)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="16">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="17">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="18">
            

            
              
            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="d01bea3a02c1dbab7b460e99b0e9b144898919a7">
  <div class="header">
    <h3>app/jobs/process_email_job.rb</h3>
    <h4>
      <span class="red">
  0.0%
</span>

      lines covered
    </h4>

    
      <h4>
        <span class="green">
  100.0%
</span>

        branches covered
      </h4>
    

    <div class="t-line-summary">
      <b>17</b> relevant lines.
      <span class="green"><b>0</b> lines covered</span> and
      <span class="red"><b>17</b> lines missed.</span>
    </div>

    
      <div class="t-branch-summary">
          <span><b>0</b> total branches, </span>
          <span class="green"><b>0</b> branches covered</span> and
          <span class="red"><b>0</b> branches missed.</span>
      </div>
    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="never" data-hits="" data-linenumber="1">
            

            
              
            

            <code class="ruby"># frozen_string_literal: true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="2">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="3">
            

            
              
            

            <code class="ruby"># app/jobs/process_email_job.rb</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="4">
            

            
              
            

            <code class="ruby">class ProcessEmailJob &lt; ApplicationJob</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="5">
            

            
              
            

            <code class="ruby">  queue_as :default</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="6">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="7">
            

            
              
            

            <code class="ruby">  def perform(email_log_id) # rubocop:disable Metrics/MethodLength, Metrics/AbcSize</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="8">
            

            
              
            

            <code class="ruby">    email_log = EmailLog.find_by(id: email_log_id)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="9">
            

            
              
            

            <code class="ruby">    return unless email_log</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="10">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="11">
            

            
              
            

            <code class="ruby">    processor = EmailProcessor.new(raw_eml: email_log.raw_data, file_name: email_log.file_name)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="12">
            

            
              
            

            <code class="ruby">    result = processor.process_and_return_result</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="13">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="14">
            

            
              
            

            <code class="ruby">    # opcional: atualiza defensivamente caso processor no tenha atualizado</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="15">
            

            
              
            

            <code class="ruby">    email_log.update!(</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="16">
            

            
              
            

            <code class="ruby">      status: (result[:status] == :success ? &#39;success&#39; : &#39;failed&#39;),</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="17">
            

            
              
            

            <code class="ruby">      message: result[:message],</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="18">
            

            
              
            

            <code class="ruby">      parsed_json: result[:parsed] || email_log.parsed_json || {}</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="19">
            

            
              
            

            <code class="ruby">    )</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="20">
            

            
              
            

            <code class="ruby">  rescue StandardError =&gt; e</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="21">
            

            
              
            

            <code class="ruby">    Rails.logger.error(&quot;[ProcessEmailJob] email_log=#{email_log_id} error: #{e.class}: #{e.message}&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="22">
            

            
              
            

            <code class="ruby">    email_log&amp;.update(status: &#39;failed&#39;, message: &quot;Exception: #{e.class}: #{e.message}&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="23">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="24">
            

            
              
            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="95356d33c21b0e24cd315f2c802349ba8ed590d0">
  <div class="header">
    <h3>app/jobs/process_upload_job.rb</h3>
    <h4>
      <span class="red">
  11.54%
</span>

      lines covered
    </h4>

    
      <h4>
        <span class="red">
  0.0%
</span>

        branches covered
      </h4>
    

    <div class="t-line-summary">
      <b>26</b> relevant lines.
      <span class="green"><b>3</b> lines covered</span> and
      <span class="red"><b>23</b> lines missed.</span>
    </div>

    
      <div class="t-branch-summary">
          <span><b>16</b> total branches, </span>
          <span class="green"><b>0</b> branches covered</span> and
          <span class="red"><b>16</b> branches missed.</span>
      </div>
    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="never" data-hits="" data-linenumber="1">
            

            
              
            

            <code class="ruby"># frozen_string_literal: true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="2">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="3">
            

            
              
            

            <code class="ruby"># app/jobs/process_upload_job.rb</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="4">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">class ProcessUploadJob &lt; ApplicationJob</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="5">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">  queue_as :default</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="6">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="7">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">  def perform(upload_id) # rubocop:disable Metrics/PerceivedComplexity, Metrics/CyclomaticComplexity, Metrics/AbcSize, Metrics/MethodLength</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="8">
            

            
              
            

            <code class="ruby">    upload = Upload.find_by(id: upload_id)</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="0" data-linenumber="9">
            

            
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
            

            <code class="ruby">    return unless upload</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="10">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="0" data-linenumber="11">
            

            
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">    upload.update!(status: &#39;processing&#39;) if upload.respond_to?(:status)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="12">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="13">
            

            
              
            

            <code class="ruby">    upload.email_logs.where(status: [&#39;pending&#39;, nil]).order(:created_at).find_each do |email_log| # rubocop:disable Metrics/BlockLength</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="14">
            

            
              
            

            <code class="ruby">      max_attempts = 6</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="15">
            

            
              
            

            <code class="ruby">      attempt = 0</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="16">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="17">
            

            
              
            

            <code class="ruby">      begin</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="18">
            

            
              
            

            <code class="ruby">        ProcessEmailJob.perform_later(email_log.id)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="19">
            

            
              
            

            <code class="ruby">      rescue ActiveRecord::StatementInvalid =&gt; e</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="20">
            

            
              
            

            <code class="ruby">        msg = e.message.to_s</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="0" data-linenumber="21">
            

            
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
            

            <code class="ruby">        raise unless msg =~ /database is locked/i || msg =~ /SQLite3::BusyException/i</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="22">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="23">
            

            
              
            

            <code class="ruby">        attempt += 1</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="24">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="0" data-linenumber="25">
            

            
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
            

            <code class="ruby">        if attempt &lt;= max_attempts</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="26">
            

            
              
            

            <code class="ruby">          sleep_time = 0.5 * attempt</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="27">
            

            
              
            

            <code class="ruby">          Rails.logger.warn(&quot;[ProcessUploadJob] SQLite lock detected for email_log=#{email_log.id} (attempt #{attempt}/#{max_attempts}), retrying in #{sleep_time}s&quot;) # rubocop:disable Layout/LineLength</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="28">
            

            
              
            

            <code class="ruby">          sleep sleep_time</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="29">
            

            
              
            

            <code class="ruby">          retry</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="" data-linenumber="30">
            

            
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">        else</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="31">
            

            
              
            

            <code class="ruby">          Rails.logger.error(&quot;[ProcessUploadJob] Giving up enqueuing ProcessEmailJob for email_log=#{email_log.id} after #{max_attempts} attempts due to persistent DB lock&quot;) # rubocop:disable Layout/LineLength</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="32">
            

            
              
            

            <code class="ruby">          begin</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="0" data-linenumber="33">
            

            
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">            if email_log.respond_to?(:update)</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="" data-linenumber="34">
            

            
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
            

            <code class="ruby">              begin</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="35">
            

            
              
            

            <code class="ruby">                email_log.update(status: &#39;failed&#39;, message: &#39;Enqueue failed: DB locked&#39;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="36">
            

            
              
            

            <code class="ruby">              rescue StandardError # rubocop:disable Metrics/BlockNesting</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="37">
            

            
              
            

            <code class="ruby">                nil</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="38">
            

            
              
            

            <code class="ruby">              end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="39">
            

            
              
            

            <code class="ruby">            end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="40">
            

            
              
            

            <code class="ruby">          rescue StandardError =&gt; _ign # rubocop:disable Lint/SuppressedException</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="41">
            

            
              
            

            <code class="ruby">          end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="42">
            

            
              
            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="43">
            

            
              
            

            <code class="ruby">      rescue StandardError =&gt; e</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="44">
            

            
              
            

            <code class="ruby">        Rails.logger.error(&quot;[ProcessUploadJob] error enqueuing ProcessEmailJob for email_log=#{email_log.id}: #{e.class}: #{e.message}&quot;) # rubocop:disable Layout/LineLength</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="45">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="46">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="47">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="0" data-linenumber="48">
            

            
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">    upload.update!(status: &#39;finished&#39;) if upload.respond_to?(:status)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="49">
            

            
              
            

            <code class="ruby">  rescue StandardError =&gt; e</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="0" data-linenumber="50">
            

            
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">    Rails.logger.error(&quot;[ProcessUploadJob] upload=#{upload_id} error: #{e.class}: #{e.message}\n#{e.backtrace&amp;.first(10)&amp;.join(&quot;\n&quot;)}&quot;) # rubocop:disable Layout/LineLength</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="51">
            

            
              
            

            <code class="ruby">    raise</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="52">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="53">
            

            
              
            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="f2241ca86c087f6aa41d060ebf3a0a2cb9dfd235">
  <div class="header">
    <h3>app/mailers/application_mailer.rb</h3>
    <h4>
      <span class="red">
  0.0%
</span>

      lines covered
    </h4>

    
      <h4>
        <span class="green">
  100.0%
</span>

        branches covered
      </h4>
    

    <div class="t-line-summary">
      <b>4</b> relevant lines.
      <span class="green"><b>0</b> lines covered</span> and
      <span class="red"><b>4</b> lines missed.</span>
    </div>

    
      <div class="t-branch-summary">
          <span><b>0</b> total branches, </span>
          <span class="green"><b>0</b> branches covered</span> and
          <span class="red"><b>0</b> branches missed.</span>
      </div>
    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="never" data-hits="" data-linenumber="1">
            

            
              
            

            <code class="ruby"># frozen_string_literal: true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="2">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="3">
            

            
              
            

            <code class="ruby">class ApplicationMailer &lt; ActionMailer::Base # rubocop:disable Style/Documentation</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="4">
            

            
              
            

            <code class="ruby">  default from: &#39;from@example.com&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="5">
            

            
              
            

            <code class="ruby">  layout &#39;mailer&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="6">
            

            
              
            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="8ed3c6ef508092e01d4cf7728b2a2eed16d49c4b">
  <div class="header">
    <h3>app/models/application_record.rb</h3>
    <h4>
      <span class="green">
  100.0%
</span>

      lines covered
    </h4>

    
      <h4>
        <span class="green">
  100.0%
</span>

        branches covered
      </h4>
    

    <div class="t-line-summary">
      <b>2</b> relevant lines.
      <span class="green"><b>2</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>

    
      <div class="t-branch-summary">
          <span><b>0</b> total branches, </span>
          <span class="green"><b>0</b> branches covered</span> and
          <span class="red"><b>0</b> branches missed.</span>
      </div>
    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="never" data-hits="" data-linenumber="1">
            

            
              
            

            <code class="ruby"># frozen_string_literal: true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="2">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="3">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">class ApplicationRecord &lt; ActiveRecord::Base # rubocop:disable Style/Documentation</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="4">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">  primary_abstract_class</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="5">
            

            
              
            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="fe178d883ec92db2a6f188890376311fb395a481">
  <div class="header">
    <h3>app/models/customer.rb</h3>
    <h4>
      <span class="green">
  100.0%
</span>

      lines covered
    </h4>

    
      <h4>
        <span class="green">
  100.0%
</span>

        branches covered
      </h4>
    

    <div class="t-line-summary">
      <b>2</b> relevant lines.
      <span class="green"><b>2</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>

    
      <div class="t-branch-summary">
          <span><b>0</b> total branches, </span>
          <span class="green"><b>0</b> branches covered</span> and
          <span class="red"><b>0</b> branches missed.</span>
      </div>
    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="never" data-hits="" data-linenumber="1">
            

            
              
            

            <code class="ruby"># frozen_string_literal: true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="2">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="3">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">class Customer &lt; ApplicationRecord # rubocop:disable Style/Documentation</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="4">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">  validates :name, :email, presence: true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="5">
            

            
              
            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="d5b36ffb0fdb8e592bbb03d3fcb01ec95d63efbe">
  <div class="header">
    <h3>app/models/email_log.rb</h3>
    <h4>
      <span class="green">
  100.0%
</span>

      lines covered
    </h4>

    
      <h4>
        <span class="green">
  100.0%
</span>

        branches covered
      </h4>
    

    <div class="t-line-summary">
      <b>3</b> relevant lines.
      <span class="green"><b>3</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>

    
      <div class="t-branch-summary">
          <span><b>0</b> total branches, </span>
          <span class="green"><b>0</b> branches covered</span> and
          <span class="red"><b>0</b> branches missed.</span>
      </div>
    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="never" data-hits="" data-linenumber="1">
            

            
              
            

            <code class="ruby"># frozen_string_literal: true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="2">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="3">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">class EmailLog &lt; ApplicationRecord # rubocop:disable Style/Documentation</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="4">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">  belongs_to :upload, optional: true, foreign_key: :upload_id</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="5">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="6">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">  validates :status, presence: true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="7">
            

            
              
            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="c2ea84266843c25e79d086508a1f3d7b26f87458">
  <div class="header">
    <h3>app/models/upload.rb</h3>
    <h4>
      <span class="red">
  31.25%
</span>

      lines covered
    </h4>

    
      <h4>
        <span class="red">
  0.0%
</span>

        branches covered
      </h4>
    

    <div class="t-line-summary">
      <b>16</b> relevant lines.
      <span class="green"><b>5</b> lines covered</span> and
      <span class="red"><b>11</b> lines missed.</span>
    </div>

    
      <div class="t-branch-summary">
          <span><b>8</b> total branches, </span>
          <span class="green"><b>0</b> branches covered</span> and
          <span class="red"><b>8</b> branches missed.</span>
      </div>
    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="never" data-hits="" data-linenumber="1">
            

            
              
            

            <code class="ruby"># frozen_string_literal: true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="2">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="3">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">class Upload &lt; ApplicationRecord # rubocop:disable Style/Documentation</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="4">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">  has_many :email_logs, foreign_key: :upload_id, dependent: :nullify</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="5">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="6">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">  enum status: {</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="7">
            

            
              
            

            <code class="ruby">    pending: &#39;pending&#39;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="8">
            

            
              
            

            <code class="ruby">    processing: &#39;processing&#39;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="9">
            

            
              
            

            <code class="ruby">    finished: &#39;finished&#39;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="10">
            

            
              
            

            <code class="ruby">    failed: &#39;failed&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="11">
            

            
              
            

            <code class="ruby">  }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="12">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="13">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">  def check_completion!</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="14">
            

            
              
            

            <code class="ruby">    done = email_logs.where.not(email_logs: { status: %w[processing pending] }).count</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="15">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="0" data-linenumber="16">
            

            
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">    return if total.zero?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="17">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="0" data-linenumber="18">
            

            
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
            

            <code class="ruby">    return unless done == total</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="19">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="20">
            

            
              
            

            <code class="ruby">    finalize_upload!</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="21">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="22">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="23">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">  def finalize_upload!</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="24">
            

            
              
            

            <code class="ruby">    errors_count = email_logs.where(status: %w[failed error]).count</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="25">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="26">
            

            
              
            

            <code class="ruby">    final_status =</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="0" data-linenumber="27">
            

            
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
            

            <code class="ruby">      if errors_count.zero?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="28">
            

            
              
            

            <code class="ruby">        :finished</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="" data-linenumber="29">
            

            
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">      else</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="30">
            

            
              
            

            <code class="ruby">        :failed</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="31">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="32">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="33">
            

            
              
            

            <code class="ruby">    update!(status: final_status)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="34">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="35">
            

            
              
            

            <code class="ruby">    # Criar log apenas se houver pelo menos um email processado</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="0" data-linenumber="36">
            

            
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
            

            <code class="ruby">    return unless total_emails.positive? &amp;&amp; email_logs.any?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="37">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="38">
            

            
              
            

            <code class="ruby">    # Log j  criado individualmente por email, no precisa criar um log geral</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="39">
            

            
              
            

            <code class="ruby">    Rails.logger.info(&quot;Upload ##{id} finalizado com status: #{final_status}. #{total_emails} email(s) processado(s).&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="40">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="41">
            

            
              
            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="08ccd42ac635b8057c6edb4aaa7b0a74d4bb8c22">
  <div class="header">
    <h3>app/services/email_processor.rb</h3>
    <h4>
      <span class="red">
  73.81%
</span>

      lines covered
    </h4>

    
      <h4>
        <span class="red">
  50.0%
</span>

        branches covered
      </h4>
    

    <div class="t-line-summary">
      <b>42</b> relevant lines.
      <span class="green"><b>31</b> lines covered</span> and
      <span class="red"><b>11</b> lines missed.</span>
    </div>

    
      <div class="t-branch-summary">
          <span><b>8</b> total branches, </span>
          <span class="green"><b>4</b> branches covered</span> and
          <span class="red"><b>4</b> branches missed.</span>
      </div>
    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="never" data-hits="" data-linenumber="1">
            

            
              
            

            <code class="ruby"># frozen_string_literal: true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="2">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="3">
            

            
              
            

            <code class="ruby"># app/services/email_processor.rb</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="4">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">require &#39;mail&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="5">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">require &#39;digest&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="6">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="7">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">class EmailProcessor # rubocop:disable Style/Documentation</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="8">
            

            
              
            

            <code class="ruby">  PARSERS = {</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="9">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    /fornecedorA.com/i =&gt; Parsers::FornecedorAParser,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="10">
            

            
              
            

            <code class="ruby">    /parceiroB.com/i =&gt; Parsers::ParceiroBParser</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="11">
            

            
              
            

            <code class="ruby">  }.freeze</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="12">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="13">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">  def initialize(raw_eml:, file_name: nil)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="14">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    @raw = raw_eml.to_s</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="15">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    @file_name = file_name</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="16">
            

            
              
            

            <code class="ruby">    @mail = begin</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="17">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      Mail.read_from_string(@raw)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="18">
            

            
              
            

            <code class="ruby">    rescue StandardError</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="19">
            

            
              
            

            <code class="ruby">      Mail.new</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="20">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="21">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="22">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="23">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">  def process_and_return_result # rubocop:disable Metrics/AbcSize, Metrics/CyclomaticComplexity, Metrics/PerceivedComplexity, Metrics/MethodLength</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="24">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    content_hash = Digest::SHA256.hexdigest(@raw)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="25">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    email_log = EmailLog.find_or_create_by(content_hash: content_hash) do |e|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="26">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      e.file_name = @file_name</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="27">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      e.raw_data = @raw</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="28">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      e.status = &#39;pending&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="29">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="30">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="31">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    parser_class = detect_parser</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="1" data-linenumber="32">
            
              <span class="hits">1</span>
            

            
              
                <span class="hits" title="else branch hit 1 times">
                  else: 1
                </span>
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
            

            <code class="ruby">    unless parser_class</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="33">
            

            
              
            

            <code class="ruby">      update_log_with(email_log, &#39;failed&#39;, &quot;No parser for from: #{Array(@mail.from).join(&#39;,&#39;)}&quot;, {})</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="34">
            

            
              
            

            <code class="ruby">      return { status: :failed, message: &#39;No parser found&#39;, parsed: {} }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="35">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="36">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="37">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    parser = parser_class.new(@mail)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="38">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    result = parser.parse # espera um hash</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="39">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="40">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    if valid_result?(result)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="41">
            

            
              
                <span class="hits" title="then branch hit 1 times">
                  then: 1
                </span>
              
            

            <code class="ruby">      # Exemplo: criar customer (se necessrio)</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="1" data-linenumber="42">
            
              <span class="hits">1</span>
            

            
              
                <span class="hits" title="then branch hit 1 times">
                  then: 1
                </span>
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">      if defined?(Customer)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="43">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">        customer = Customer.create!(name: result[:name], email: result[:email], phone: result[:phone],</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="44">
            

            
              
            

            <code class="ruby">                                    product_code: result[:product_code])</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="45">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="46">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      update_log_with(email_log, &#39;success&#39;, &#39;Parsed successfully&#39;, result)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="47">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      { status: :success, message: &#39;Parsed successfully&#39;, parsed: result, customer: customer }</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="" data-linenumber="48">
            

            
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">    else</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="49">
            

            
              
            

            <code class="ruby">      update_log_with(email_log, &#39;failed&#39;, &#39;Missing contact info&#39;, result || {})</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="50">
            

            
              
            

            <code class="ruby">      { status: :failed, message: &#39;Missing contact info&#39;, parsed: result || {} }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="51">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="52">
            

            
              
            

            <code class="ruby">  rescue StandardError =&gt; e</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="53">
            

            
              
            

            <code class="ruby">    Rails.logger.error(&quot;[EmailProcessor] error: #{e.class}: #{e.message}\n#{e.backtrace.first(10).join(&quot;\n&quot;)}&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="54">
            

            
              
            

            <code class="ruby">    email_log ||= EmailLog.find_or_create_by(content_hash: Digest::SHA256.hexdigest(@raw)) do |el|</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="55">
            

            
              
            

            <code class="ruby">      el.file_name = @file_name</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="56">
            

            
              
            

            <code class="ruby">      el.raw_data = @raw</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="57">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="58">
            

            
              
            

            <code class="ruby">    update_log_with(email_log, &#39;failed&#39;, &quot;Exception: #{e.class}: #{e.message}&quot;, {})</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="59">
            

            
              
            

            <code class="ruby">    { status: :failed, message: &quot;Exception: #{e.class}: #{e.message}&quot;, parsed: {} }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="60">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="61">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="62">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">  private</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="63">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="64">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">  def detect_parser</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="65">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    from = Array(@mail.from).join(&#39; &#39;)</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="2" data-linenumber="66">
            
              <span class="hits">2</span>
            

            
              
                <span class="hits" title="then branch hit 1 times">
                  then: 1
                </span>
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">    PARSERS.find { |pattern, _klass| from.match?(pattern) }&amp;.last</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="67">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="68">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="69">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">  def valid_result?(res)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="70">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    res &amp;&amp; res[:name].to_s.strip != &#39;&#39; &amp;&amp; res[:email].to_s.strip != &#39;&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="71">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="72">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="73">
            

            
              
            

            <code class="ruby">  # atualiza o email_log j existente (em vez de criar outro)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="74">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">  def update_log_with(email_log, status, message, parsed)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="75">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    email_log.update!(</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="76">
            

            
              
            

            <code class="ruby">      status: status,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="77">
            

            
              
            

            <code class="ruby">      message: message,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="78">
            

            
              
            

            <code class="ruby">      parsed_json: parsed</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="79">
            

            
              
            

            <code class="ruby">    )</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="80">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="81">
            

            
              
            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="56a76ca0e031e0772af13d371e5ce0fe9fd633d0">
  <div class="header">
    <h3>app/services/parsers/fornecedor_a_parser.rb</h3>
    <h4>
      <span class="green">
  100.0%
</span>

      lines covered
    </h4>

    
      <h4>
        <span class="green">
  100.0%
</span>

        branches covered
      </h4>
    

    <div class="t-line-summary">
      <b>4</b> relevant lines.
      <span class="green"><b>4</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>

    
      <div class="t-branch-summary">
          <span><b>0</b> total branches, </span>
          <span class="green"><b>0</b> branches covered</span> and
          <span class="red"><b>0</b> branches missed.</span>
      </div>
    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="never" data-hits="" data-linenumber="1">
            

            
              
            

            <code class="ruby"># frozen_string_literal: true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="2">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="3">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">module Parsers</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="4">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">  class FornecedorAParser &lt; ParserBase # rubocop:disable Style/Documentation</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="5">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    def parse</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="6">
            

            
              
            

            <code class="ruby">      {</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="7">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">        name: extract_by_label(&#39;Nome do cliente&#39;, &#39;Nome&#39;),</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="8">
            

            
              
            

            <code class="ruby">        email: extract_by_label(&#39;E-mail&#39;, &#39;E-mail&#39;),</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="9">
            

            
              
            

            <code class="ruby">        phone: extract_by_label(&#39;Telefone&#39;, &#39;Telefone&#39;),</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="10">
            

            
              
            

            <code class="ruby">        product_code: @body.match(/c[o]digo\s*(?:do\s*)?produto\s*[:-]?\s*(\w+)/i) &amp;&amp; ::Regexp.last_match(1),</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="11">
            

            
              
            

            <code class="ruby">        subject: @mail.subject</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="12">
            

            
              
            

            <code class="ruby">      }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="13">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="14">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="15">
            

            
              
            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="8b7cb608140213323a546a1f87de3168f7a72b32">
  <div class="header">
    <h3>app/services/parsers/parceiro_b_parser.rb</h3>
    <h4>
      <span class="red">
  60.0%
</span>

      lines covered
    </h4>

    
      <h4>
        <span class="red">
  0.0%
</span>

        branches covered
      </h4>
    

    <div class="t-line-summary">
      <b>5</b> relevant lines.
      <span class="green"><b>3</b> lines covered</span> and
      <span class="red"><b>2</b> lines missed.</span>
    </div>

    
      <div class="t-branch-summary">
          <span><b>8</b> total branches, </span>
          <span class="green"><b>0</b> branches covered</span> and
          <span class="red"><b>8</b> branches missed.</span>
      </div>
    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="never" data-hits="" data-linenumber="1">
            

            
              
            

            <code class="ruby"># frozen_string_literal: true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="2">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="3">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">module Parsers</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="4">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">  class ParceiroBParser &lt; ParserBase # rubocop:disable Style/Documentation</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="5">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    def parse</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="6">
            

            
              
            

            <code class="ruby">      {</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="7">
            

            
              
            

            <code class="ruby">        name: extract_by_label(&#39;Cliente&#39;, &#39;Nome do interessado&#39;, &#39;Nome&#39;),</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="" data-linenumber="8">
            

            
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">        email: extract_by_label(&#39;Contato&#39;, &#39;Email&#39;, &#39;E-mail&#39;)&amp;.to_s&amp;.split(/[|\s]/)&amp;.first,</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="" data-linenumber="9">
            

            
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">        phone: extract_by_label(&#39;Contato&#39;, &#39;Telefone&#39;)&amp;.to_s,</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="10">
            

            
              
            

            <code class="ruby">        product_code: (@body.match(/Produto\s*[:-]?\s*(\w+)/i) &amp;&amp; ::Regexp.last_match(1)) || @mail.subject[/\b([A-Z0-9]{3,})\b/], # rubocop:disable Layout/LineLength</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="11">
            

            
              
            

            <code class="ruby">        subject: @mail.subject</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="12">
            

            
              
            

            <code class="ruby">      }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="13">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="14">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="15">
            

            
              
            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="7ffc7b4161f59f98d9d79393a1342a731565b80a">
  <div class="header">
    <h3>app/services/parsers/parser_base.rb</h3>
    <h4>
      <span class="yellow">
  83.33%
</span>

      lines covered
    </h4>

    
      <h4>
        <span class="red">
  33.33%
</span>

        branches covered
      </h4>
    

    <div class="t-line-summary">
      <b>18</b> relevant lines.
      <span class="green"><b>15</b> lines covered</span> and
      <span class="red"><b>3</b> lines missed.</span>
    </div>

    
      <div class="t-branch-summary">
          <span><b>6</b> total branches, </span>
          <span class="green"><b>2</b> branches covered</span> and
          <span class="red"><b>4</b> branches missed.</span>
      </div>
    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="never" data-hits="" data-linenumber="1">
            

            
              
            

            <code class="ruby"># frozen_string_literal: true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="2">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="3">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">module Parsers</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="4">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">  class ParserBase # rubocop:disable Style/Documentation</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="5">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    def initialize(mail)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="6">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      @mail = mail</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="7">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      @body = extract_body</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="8">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="9">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="10">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    def parse</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="11">
            

            
              
            

            <code class="ruby">      raise NotImplementedError</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="12">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="13">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="14">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    private</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="15">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="16">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    def extract_body</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="1" data-linenumber="17">
            
              <span class="hits">1</span>
            

            
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
            

            <code class="ruby">      if @mail.multipart?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="18">
            

            
              
            

            <code class="ruby">        part = @mail.parts.find { |p| p.content_type =~ %r{text/plain} }</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="0" data-linenumber="19">
            

            
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">        part ? part.decoded : @mail.parts.first.decoded</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="20">
            

            
              
                <span class="hits" title="else branch hit 1 times">
                  else: 1
                </span>
              
            

            <code class="ruby">      else</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="21">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">        @mail.body.decoded</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="22">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="23">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="24">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="25">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    def extract_by_label(*labels)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="26">
            
              <span class="hits">3</span>
            

            
              
            

            <code class="ruby">      labels.each do |label|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="27">
            
              <span class="hits">3</span>
            

            
              
            

            <code class="ruby">        re = /#{label}\s*[:-]?\s*(.+)/i</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="3" data-linenumber="28">
            
              <span class="hits">3</span>
            

            
              
                <span class="hits" title="then branch hit 3 times">
                  then: 3
                </span>
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">        if (m = @body.match(re))</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="29">
            
              <span class="hits">3</span>
            

            
              
            

            <code class="ruby">          return m[1].to_s.strip</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="30">
            

            
              
            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="31">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="32">
            

            
              
            

            <code class="ruby">      nil</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="33">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="34">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="35">
            

            
              
            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
      </div>
    </div>
  </body>
</html>
